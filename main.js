(()=>{"use strict";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{lB:()=>x,Kz:()=>D,wo:()=>j,bj:()=>N,O9:()=>B,OT:()=>w,N_:()=>P,KS:()=>O,An:()=>A,z0:()=>U,SI:()=>T,Xd:()=>G});var t=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},o=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))};function n(e,n){var r=Array.from(e.querySelectorAll(n.inputSelector));r.forEach((function(o){return t(e,o,n)})),o(r,e.querySelector(n.submitButtonSelector),n)}function r(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",c),document.addEventListener("keydown",i)}function a(e){e.removeEventListener("mousedown",c),document.removeEventListener("keydown",i),e.classList.remove("popup_opened")}function c(e){e.currentTarget===e.target&&a(e.currentTarget)}function i(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}function u(e){return e.ok?e.json():Promise.reject(e.status)}function s(e,t){t.textContent=e?"Сохранение...":"Сохранить"}document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return a(t)}))}));var l={baseUrl:"https://nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"257608b2-435d-4812-89a7-aa07205ef2dd","Content-Type":"application/json"}};function d(e,t){var o=x.querySelector(".articles__item").cloneNode(!0),n=o.querySelector(".articles__title"),a=o.querySelector(".articles__photo"),c=o.querySelector(".articles__likes-count");n.textContent=e.name,a.src=e.link,a.alt=e.name,c.textContent=e.likes.length,o.setAttribute("data-id",e._id),o.setAttribute("data-owner-id",e.owner._id);var i=o.querySelector(".articles__like");e.likes.some((function(e){return e._id===t}))&&i.classList.add("articles__like_active"),i.addEventListener("click",(function(){var e,t,n,r;i.classList.contains("articles__like_active")?(n=o,r=n.getAttribute("data-id"),fetch("".concat(l.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:l.headers}).then(u)).then((function(e){i.classList.remove("articles__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)})):(e=o,t=e.getAttribute("data-id"),fetch("".concat(l.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:l.headers}).then(u)).then((function(e){i.classList.add("articles__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))}));var s=o.querySelector(".articles__delete");return e.owner._id!==t?s.setAttribute("style","display:none;"):s.addEventListener("click",(function(){var e,t;(e=o,t=e.getAttribute("data-id"),fetch("".concat(l.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:l.headers}).then(u)).then((function(){o.remove()})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){r(A),T.src=a.src,T.alt=n.textContent,U.textContent=n.textContent})),o}var p=document.querySelector(".author__name-edit"),f=document.forms["profile-form"],m=f.querySelector("fieldset.popup__form-fields"),_=f.querySelector(".popup__form-button"),v=document.querySelector(".author__add"),h=document.forms["card-form"],y=h.querySelector("fieldset.popup__form-fields"),S=h.elements.cardName,b=h.elements.imgLink,q=h.querySelector(".popup__form-button"),L=document.querySelector(".articles__grid"),E=document.querySelector(".author__avatar-edit"),k=document.forms["avatar-form"],C=k.querySelector("fieldset.popup__form-fields"),g=k.querySelector(".popup__form-button"),x=document.querySelector("#article").content,A=document.querySelector(".popup_type_pic"),T=A.querySelector(".popup__picture"),U=A.querySelector(".popup__caption"),w=document.querySelector(".p-author"),O=document.querySelector(".p-card"),P=document.querySelector(".p-avatar"),B=f.elements.authorName,N=f.elements.authorPosition,j=document.querySelector(".author__name-text"),D=document.querySelector(".author__position"),z="",J=document.querySelector(".author__avatar"),M=k.elements.avatarLink,G={formSelector:".popup__form",inputSelector:".popup__form-field",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__form-field_type-error",errorClass:"popup__form-field-error_active"};Promise.all([fetch("".concat(l.baseUrl,"/users/me"),{method:"GET",headers:l.headers}).then(u),fetch("".concat(l.baseUrl,"/cards"),{method:"GET",headers:l.headers}).then(u)]).then((function(e){var t=e[0],o=e[1];z=t._id,H(t),K(o,z)})).catch((function(e){console.log(e)}));var H=function(e){j.textContent=e.name,D.textContent=e.about,J.src=e.avatar},K=function(e,t){e.forEach((function(e){var o=d(e,t);L.prepend(o)}))};!function(e){Array.from(document.forms).forEach((function(n){n.addEventListener("submit",(function(e){e.preventDefault()})),function(e,n){var r=Array.from(e.querySelectorAll(n.inputSelector)),a=e.querySelector(n.submitButtonSelector);o(r,a,n),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,o,n){o.validity.patternMismatch?o.setCustomValidity(o.dataset.errorMessage):o.setCustomValidity(""),o.validity.valid?t(e,o,n):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,o,o.validationMessage,n)}(e,c,n),o(r,a,n)}))}))}(n,e)}))}(G),p.addEventListener("click",(function(){r(w),B.value=j.textContent,N.value=D.textContent,n(w.querySelector(".popup__form"),G)})),v.addEventListener("click",(function(){r(O),n(O.querySelector(".popup__form"),G)})),E.addEventListener("click",(function(){r(P),n(P.querySelector(".popup__form"),G)})),h.addEventListener("submit",(function(e){e.preventDefault(),s(!0,q),y.name=S.value,y.link=b.value,function(e){return fetch("".concat(l.baseUrl,"/cards"),{method:"POST",headers:l.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(u)}(y).then((function(e){var t;t=e,L.prepend(d(t))})).catch((function(e){console.log(e)})).finally((function(){s(!1,q)})),q.disabled=!0,q.classList.add("popup__form-button_inactive"),e.target.reset(),a(e.target.closest(".popup"))})),f.addEventListener("submit",(function(e){e.preventDefault(),s(!0,_),m.name=B.value,m.about=N.value,function(e){return fetch("".concat(l.baseUrl,"/users/me"),{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(u)}(m).then((function(e){j.textContent=e.name,D.textContent=e.about})).catch((function(e){console.log(e)})).finally((function(){s(!1,_)})),_.disabled=!0,_.classList.add("popup__form-button_inactive"),a(e.target.closest(".popup"))})),k.addEventListener("submit",(function(e){e.preventDefault(),s(!0,g),C.link=M.value,function(e){return fetch("".concat(l.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e.link})}).then(u)}(C).then((function(e){J.src=e.avatar})).catch((function(e){console.log(e)})).finally((function(){s(!1,g)})),g.disabled=!0,g.classList.add("popup__form-button_inactive"),e.target.reset(),a(e.target.closest(".popup"))}))})();