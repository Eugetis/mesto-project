(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{lB:()=>x,Kz:()=>D,wo:()=>j,bj:()=>N,O9:()=>B,OT:()=>U,N_:()=>P,KS:()=>O,An:()=>T,z0:()=>w,SI:()=>A,Xd:()=>G});var t=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},n=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};function o(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector));r.forEach((function(n){return t(e,n,o)})),n(r,e.querySelector(o.submitButtonSelector),o)}function r(e){e.classList.add("popup_opened"),e.addEventListener("mousedown",c),document.addEventListener("keydown",i)}function a(e){e.removeEventListener("mousedown",c),document.removeEventListener("keydown",i),e.classList.remove("popup_opened")}function c(e){e.currentTarget===e.target&&a(e.currentTarget)}function i(e){"Escape"===e.key&&a(document.querySelector(".popup_opened"))}document.querySelectorAll(".popup__close").forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return a(t)}))}));var u={baseUrl:"https://nomoreparties.co/v1/plus-cohort-26",headers:{authorization:"257608b2-435d-4812-89a7-aa07205ef2dd","Content-Type":"application/json"}};function s(e){return e.ok?e.json():Promise.reject(e.status)}function l(e,t){var n=x.querySelector(".articles__item").cloneNode(!0),o=n.querySelector(".articles__title"),a=n.querySelector(".articles__photo"),c=n.querySelector(".articles__likes-count");o.textContent=e.name,a.src=e.link,a.alt=e.name,c.textContent=e.likes.length,n.setAttribute("data-id",e._id),n.setAttribute("data-owner-id",e.owner._id);var i=n.querySelector(".articles__like");e.likes.some((function(e){return e._id===t}))&&i.classList.add("articles__like_active"),i.addEventListener("click",(function(){var e,t,o,r;i.classList.contains("articles__like_active")?(o=n,r=o.getAttribute("data-id"),fetch("".concat(u.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:u.headers}).then(s)).then((function(e){i.classList.remove("articles__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)})):(e=n,t=e.getAttribute("data-id"),fetch("".concat(u.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:u.headers}).then(s)).then((function(e){i.classList.add("articles__like_active"),c.textContent=e.likes.length})).catch((function(e){console.log(e)}))}));var l=n.querySelector(".articles__delete");return e.owner._id!==t?l.remove():l.addEventListener("click",(function(){var e,t;(e=n,t=e.getAttribute("data-id"),fetch("".concat(u.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:u.headers}).then(s)).then((function(){n.remove()})).catch((function(e){console.log(e)}))})),a.addEventListener("click",(function(){r(T),A.src=a.src,A.alt=o.textContent,w.textContent=o.textContent})),n}function d(e,t){e?t.innerText="Сохранение...":setTimeout((function(){t.innerText=t.dataset.text}),300)}var f=document.querySelector(".author__name-edit"),p=document.forms["profile-form"],m=p.querySelector("fieldset.popup__form-fields"),_=p.querySelector(".popup__form-button"),v=document.querySelector(".author__add"),h=document.forms["card-form"],y=h.querySelector("fieldset.popup__form-fields"),S=h.elements.cardName,b=h.elements.imgLink,q=h.querySelector(".popup__form-button"),E=document.querySelector(".articles__grid"),L=document.querySelector(".author__avatar-edit"),k=document.forms["avatar-form"],g=k.querySelector("fieldset.popup__form-fields"),C=k.querySelector(".popup__form-button"),x=document.querySelector("#article").content,T=document.querySelector(".popup_type_pic"),A=T.querySelector(".popup__picture"),w=T.querySelector(".popup__caption"),U=document.querySelector(".p-author"),O=document.querySelector(".p-card"),P=document.querySelector(".p-avatar"),B=p.elements.authorName,N=p.elements.authorPosition,j=document.querySelector(".author__name-text"),D=document.querySelector(".author__position"),z="",J=document.querySelector(".author__avatar"),M=k.elements.avatarLink,G={formSelector:".popup__form",inputSelector:".popup__form-field",submitButtonSelector:".popup__form-button",inactiveButtonClass:"popup__form-button_inactive",inputErrorClass:"popup__form-field_type-error",errorClass:"popup__form-field-error_active"};Promise.all([fetch("".concat(u.baseUrl,"/users/me"),{method:"GET",headers:u.headers}).then(s),fetch("".concat(u.baseUrl,"/cards"),{method:"GET",headers:u.headers}).then(s)]).then((function(e){var t=e[0],n=e[1];z=t._id,H(t),K(n,z)})).catch((function(e){console.log(e)}));var H=function(e){j.textContent=e.name,D.textContent=e.about,J.src=e.avatar},K=function(e,t){e.forEach((function(e){var n=l(e,t);E.prepend(n)}))};!function(e){Array.from(document.forms).forEach((function(o){o.addEventListener("submit",(function(e){e.preventDefault()})),function(e,o){var r=Array.from(e.querySelectorAll(o.inputSelector)),a=e.querySelector(o.submitButtonSelector);n(r,a,o),r.forEach((function(c){c.addEventListener("input",(function(){!function(e,n,o){n.validity.patternMismatch?n.setCustomValidity(n.dataset.errorMessage):n.setCustomValidity(""),n.validity.valid?t(e,n,o):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,n,n.validationMessage,o)}(e,c,o),n(r,a,o)}))}))}(o,e)}))}(G),f.addEventListener("click",(function(){r(U),B.value=j.textContent,N.value=D.textContent,o(U.querySelector(".popup__form"),G)})),v.addEventListener("click",(function(){r(O),o(O.querySelector(".popup__form"),G)})),L.addEventListener("click",(function(){r(P),o(P.querySelector(".popup__form"),G)})),h.addEventListener("submit",(function(e){e.preventDefault(),d(!0,q),y.name=S.value,y.link=b.value,function(e){return fetch("".concat(u.baseUrl,"/cards"),{method:"POST",headers:u.headers,body:JSON.stringify({name:e.name,link:e.link})}).then(s)}(y).then((function(t){var n,o;n=t,o=t.owner._id,E.prepend(l(n,o)),e.target.reset(),a(e.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){d(!1,q)}))})),p.addEventListener("submit",(function(e){e.preventDefault(),d(!0,_),m.name=B.value,m.about=N.value,function(e){return fetch("".concat(u.baseUrl,"/users/me"),{method:"PATCH",headers:u.headers,body:JSON.stringify({name:e.name,about:e.about})}).then(s)}(m).then((function(t){j.textContent=t.name,D.textContent=t.about,a(e.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){d(!1,_)}))})),k.addEventListener("submit",(function(e){e.preventDefault(),d(!0,C),g.link=M.value,function(e){return fetch("".concat(u.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:u.headers,body:JSON.stringify({avatar:e.link})}).then(s)}(g).then((function(t){J.src=t.avatar,e.target.reset(),a(e.target.closest(".popup"))})).catch((function(e){console.log(e)})).finally((function(){d(!1,C)}))}))})();